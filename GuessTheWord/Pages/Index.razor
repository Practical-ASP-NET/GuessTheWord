@page "/"

<PageTitle>Guess The Word</PageTitle>

<Flower GuessesLeft="@RemainingAttempts" />

<TargetWord Target="@_targetWord" FoundLetters="_foundLetters"/>

<Alphabet LetterSelected="OnLetterSelected" 
          Disabled="@(_status != "running")"/>

@if (_status != "running")
{
    <Result Status="@_status" Answer="@_targetWord"/>
}

@code {

    readonly string _targetWord = Films.Random();

    readonly HashSet<char> _foundLetters = new();

    int _incorrectAnswers = 0;
    private string _status = "running";
    int RemainingAttempts => 6 - _incorrectAnswers;

    private void OnLetterSelected(char letter)
    {
        if (GameHelpers.CheckLetter(letter, _targetWord))
        {
            _foundLetters.Add(letter);
        }
        else
        {
            _incorrectAnswers++;
        }

        _status = CheckStatus();
    }

    private string CheckStatus()
    {
        var guessedCorrectly = GameHelpers.AllLettersFound(_targetWord, _foundLetters);
        
        if (guessedCorrectly)
        {
            return "won";
        }
        
        if (RemainingAttempts == 0)
        {
            return "lost";
        }

        return "running";
    }

}
